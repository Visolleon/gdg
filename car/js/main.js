(function(d){var c=function(a){this.ID=a.id||this.NewGuid();this.gamecanvas=document.getElementById(a.id);(this.context=this.gamecanvas.getContext("2d"))?a.success&&a.success():a.error&&a.error();this.Height=this.gamecanvas.height;this.Width=this.gamecanvas.width;this.SpriteArray=[];this.ExpectFPS=60;this.Interval=parseInt(1E3/this.ExpectFPS,10);this.FrameCount=0;this.LastFrameTime=(new Date).getTime();this.FPS=0;this.IsSupportFullScreen=!1;this.Prefix="";this.IsFullScreen=!1;a=["webkit","moz","o",
"ms","khtml"];if(document.cancelFullScreen)this.IsSupportFullScreen=!0;else for(var b=0;b<a.length;b++)if(document[a[b]+"CancelFullScreen"]){this.Prefix=a[b];this.IsSupportFullScreen=!0;break}};c.prototype={NewGuid:function(){for(var a="",b=1;32>=b;b++)var c=Math.floor(16*Math.random()).toString(16),a=a+c;return a},Add:function(a){this.SpriteArray.push(a);this.Sort()},Sort:function(){for(var a=0;a<this.SpriteArray.length;a++)for(var b=0;b<this.SpriteArray.length-a-1;b++)if(this.SpriteArray[b].zIndex>
this.SpriteArray[b+1].zIndex){var c=this.SpriteArray[b];this.SpriteArray[b]=this.SpriteArray[b+1];this.SpriteArray[b+1]=c}},Start:function(){this.FrameCount>=this.ExpectFPS&&(this.FPS=Math.round(1E4*this.FrameCount/((new Date).getTime()-this.LastFrameTime))/10,this.FPS<this.ExpectFPS-0.5?this.Interval--:this.FPS>this.ExpectFPS+0.5&&this.Interval++,this.FrameCount=0,this.LastFrameTime=(new Date).getTime());this.Update();this.FrameCount++;setTimeout(function(){this.Start()}.bind(this),this.Interval)},
Update:function(){this.context.clearRect(0,0,this.Width,this.Height);for(var a=0;a<this.SpriteArray.length;a++){var b=this.SpriteArray[a];if(b.__destroy)this.SpriteArray[a]=null,this.SpriteArray.splice(a,1);else if(b.Visible){if(0<a&&b.zIndex<this.SpriteArray[a-1].zIndex)break;this.context.save();1<b.Alpha&&(b.Alpha=1);null!=b.Alpha&&(this.context.globalAlpha=0<=b.Alpha&&1>=b.Alpha?b.Alpha:1<b.Alpha?1:0);b.Translate&&this.context.translate(b.Translate[0],b.Translate[1]);b.Rotate&&this.context.rotate(b.Rotate);
b.Scale&&this.context.scale(b.Scale[0],b.Scale[1]);b.Run(this.context);this.context.restore()}}},FullScreen:function(){if(this.IsSupportFullScreen){if(""===this.Prefix)this.gamecanvas.requestFullScreen();else this.gamecanvas[this.Prefix+"RequestFullScreen"]();this.IsFullScreen=!0}},CancelFullScreen:function(){if(this.IsSupportFullScreen){if(""===this.Prefix)document.cancelFullScreen();else document[this.Prefix+"CancelFullScreen"]();this.IsFullScreen=!1}}};d.Game=d.vGamebase=c;c.Extend=function(a){var b=
function(){this.Size=null;this.zIndex=0;this.Position=[0,0];this.Translate=this.Rotate=null;this.Alpha=1;this.Scale=[1,1];this.Visible=!0;this.__destroy=!1;this.Drag=this.Click=null;this.Destroy=function(){this.__destroy=!0};2===arguments.length&&"_arguments_"===arguments[0]?this.Init.apply(this,arguments[1]):this.Init.apply(this,arguments)};b.prototype=a;d[a.Type]=c[a.Type]=b;c.prototype["create"+a.Type]=function(){var a=new b("_arguments_",arguments);this.Add(a);return a}};c.Extend({Type:"Bitmap",
DataType:"url",image:null,SetImage:function(a){a&&a.constructor.toString().match(/function Image/)?(this.DataType="image",this.image=a,this.Size||(this.Size=[a.width,a.height])):a&&a.constructor.toString().match(/function ImageData/)?(this.DataType="imagedata",this.image=a):(this.DataType="url",this.image=new Image,this.image.src=a,this.image.onload=function(){this.Size||(this.Size=[this.image.width,this.image.height])}.bind(this))},Init:function(a){this.SetImage(a)},Run:function(a){if(this.Size)if(null==
this.StartPoint)"imagedata"==this.DataType?a.putImageData(this.image,this.Position[0],this.Position[1]):a.drawImage(this.image,this.Position[0],this.Position[1],this.Size[0],this.Size[1]);else{var b=this.Size[0],c=this.Size[1];this.image.width-this.StartPoint[0]<this.Size[0]&&(b=this.image.width-this.StartPoint[0]);this.image.height-this.StartPoint[1]<this.Size[1]&&(c=this.image.height-this.StartPoint[1]);"imagedata"==this.DataType?a.putImageData(this.image,this.Position[0],this.Position[1]):0<b&&
0<c&&a.drawImage(this.image,this.StartPoint[0],this.StartPoint[1],b,c,this.Position[0],this.Position[1],b,c)}else a.drawImage(this.image,this.Position[0],this.Position[1])}});c.Extend({Type:"Shape",Order:null,Init:function(a){this.Order=a},Run:function(a){this.Order&&this.Order(a)}});c.Extend({Type:"Arc",Radius:0,StartAngle:0,EndAngle:0,AntiClockWise:!1,Style:null,BorderStyle:null,Border:0,Init:function(a,b,c,e,d,f,h,m,k){this.Position=[a,b];this.Radius=c;this.StartAngle=e;this.EndAngle=d;this.AntiClockWise=
f;this.Style=h;this.BorderStyle=m;k&&(this.Border=k)},Run:function(a){a.strokeStyle=this.BorderStyle?this.BorderStyle:"rgba(0,0,0,0)";a.lineWidth=this.Border;a.beginPath();a.arc(this.Position[0],this.Position[1],this.Radius,this.StartAngle,this.EndAngle,this.AntiClockWise);this.Style&&(a.fillStyle=this.Style,a.fill());a.stroke();a.closePath()}});c.Extend({Type:"Rect",Width:0,Height:0,Style:null,BorderStyle:null,Border:0,Init:function(a,b,c,e,d,f,h){this.Position=[a,b];this.Width=c;this.Height=e;this.Style=
d;this.BorderStyle=f;h&&(this.Border=h)},Run:function(a){a.lineWidth=this.Border;this.Style&&(a.fillStyle=this.Style);a.fillRect(this.Position[0],this.Position[1],this.Width,this.Height);this.Border&&(this.BorderStyle&&(a.strokeStyle=this.BorderStyle),a.strokeRect(this.Position[0],this.Position[1],this.Width,this.Height))}});c.Extend({Type:"Line",EndPosition:null,Border:1,Style:null,Init:function(a,b,c,e,d,f){this.Position=[a,b];this.EndPosition=[c,e];this.Style=d;f&&(this.Border=f)},Run:function(a){a.strokeStyle=
this.Style;a.lineWidth=this.Border;a.beginPath();a.moveTo(this.Position[0],this.Position[1]);a.lineTo(this.EndPosition[0],this.EndPosition[1]);a.stroke();a.closePath()}});c.Extend({Type:"Polygon",Points:null,Border:1,Style:null,BorderStyle:null,Init:function(a,b,c,e){this.Points=a;this.Style=b;this.BorderStyle=c;this.Border=e},Run:function(a){if(this.Points){a.strokeStyle=this.BorderStyle;a.lineWidth=this.Border;a.beginPath();a.moveTo(this.Points[0][0],this.Points[0][1]);for(var b=1;b<this.Points.length;b++)this.Position?
a.lineTo(this.Points[b][0]+this.Position[0],this.Points[b][1]+this.Position[1]):a.lineTo(this.Points[b][0],this.Points[b][1]);a.lineTo(this.Points[0][0],this.Points[0][1]);a.stroke();this.Style&&(a.fillStyle=this.Style,a.fill());a.closePath()}}});c.Extend({Type:"Label",Text:"",ShadowX:null,ShadowY:null,ShadowBlur:null,ShadowStyle:null,Style:null,Font:null,Init:function(a){this.Text=a},Run:function(a){this.ShadowX&&(a.shadowOffsetX=this.ShadowX);this.ShadowY&&(a.shadowOffsetY=this.ShadowY);this.ShadowBlur&&
(a.shadowBlur=this.ShadowBlur);this.ShadowStyle&&(a.shadowStyle=this.ShadowStyle);this.Font&&(a.font=this.Font);this.Style&&(a.fillStyle=this.Style);a.fillText(this.Text,this.Position[0],this.Position[1])}});Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,e=function(){},d=function(){return c.apply(this instanceof
e?this:a,b.concat(Array.prototype.slice.call(arguments)))};e.prototype=this.prototype;d.prototype=new e;return d});d.Sound=function(a){this.IsPlaying=this.Loop=!1;if(Audio)this.Audio=new Audio,this.Audio.src=a,this.Audio.preload="auto",this.Audio.load(),this.SetVolume=function(a){this.Audio.volume=a},this.Play=function(){this.IsPlaying=!0;this.Loop?(this.Audio.loop="loop",this.Audio.addEventListener("ended",function(){this.Audio.currentTime=0}.bind(this),!1)):this.Audio.addEventListener("ended",function(){this.IsPlaying=
!1}.bind(this),!1);this.Audio.play()},this.Pause=function(){this.Audio.pause();this.IsPlaying=!1},this.Stop=function(){try{this.Audio.pause(),this.Audio.currentTime=0,this.IsPlaying=!1}catch(a){}};else return console.log("Your browser not support audio."),{Loop:this.Loop,IsPlaying:this.IsPlaying,Audio:{src:a},SetVolume:function(){console.log("try to set audio volumn failed.")},Play:function(){console.log("try to play audio failed.")},Pause:function(){console.log("try to pause audio failed.")},Stop:function(){console.log("try to stop audio failed.")}}}})(window);
var car=function(d){var c=new Bitmap("images/car.png");c.zIndex=10;var a=new Bitmap("images/blaze.png");a.zIndex=8;a.Alpha=0;a.Position=[c.Position[0]+6,c.Position[1]+150];var b=new Bitmap("images/light.png");b.zIndex=8;b.Alpha=0;b.Position=[c.Position[0]-16,c.Position[1]-150];var g=new Bitmap("images/focus.png");g.zIndex=9;g.Position=[c.Position[0]-257,c.Position[1]-212];d.Add(c);d.Add(a);d.Add(b);var e=0,i,f;setInterval(function(){0<e?(i&&i.run(e),f&&f.run(e/30),e-=0.02*e,a.Alpha=10>e?e/10:1,2>
e?0.5>e?b.Alpha=0:0.5<b.Alpha&&(b.Alpha=0.5):b.Alpha=1):e=0}.bind(this),20);var h=!1;this.init=function(e,d,j,l){h||(c.Position=[e,d],b.Position=[e-16,d-150],a.Position=[e+6,d+150],g.Position=[e-257,d-212],h=!0);j&&(i=j);l&&(f=l)};this.start=function(){b.Alpha=1;var c=setInterval(function(){1>a.Alpha?a.Alpha+=0.1:clearInterval(c)},30)};this.stop=function(){var c=setInterval(function(){0<a.Alpha?a.Alpha-=0.1:(clearInterval(c),b.Alpha=0)},30)};this.run=function(){20>e&&(e+=1)};this.getSpeed=function(){return e}},
road=function(d){var c=d.createBitmap("images/road1.png");c.zIndex=1;var a=new Bitmap("images/road1.png");a.Alpha=0;d.Add(a);var b=!1;this.init=function(a,d){b||(c.Position=[a,d],b=!0)};var g=!0;this.run=function(b){g?(c.Position=[c.Position[0],c.Position[1]+b],c.Position[1]>d.Height&&(g=!1),0<c.Position[1]&&(a.Alpha=1,a.Position=[c.Position[0],c.Position[1]-a.Size[1]])):(a.Position=[a.Position[0],a.Position[1]+b],a.Position[1]>d.Height&&(g=!0),0<a.Position[1]&&(c.Position=[c.Position[0],a.Position[1]-
c.Size[1]]))}},scene=function(d){function c(a){var b=a.Position[1];a.Scale&&0<a.Scale[1]&&(b*=a.Scale[1]);b>d.Height+a.Size[1]&&(a.Position[0]=Math.floor(1E3*Math.random()),a.Position[1]=-a.Size[1])}var a=d.createBitmap("images/sky.png"),b=new Bitmap("images/sky.png");b.Alpha=0;d.Add(b);var g=d.createBitmap("images/star.png");g.Position=[0,100];g.zIndex=3;for(var e=[],i=0;6>i;i++){var f=d.createBitmap("images/star2.png");f.Position=[Math.floor(Math.random()*d.Width),Math.floor(Math.random()*d.Height)];
4<Math.floor(10*Math.random())&&(f.Scale=[0.5,0.5]);f.zIndex=2;e.push(f)}var h=!0;this.run=function(d){g.Position[1]+=4*d;c(g);for(var f=0;f<e.length;f++){var j=e[f],i=2;0.5==j.Scale[1]&&(i=1.5);j.Position[1]+=d*i;c(j)}h?(a.Position=[a.Position[0],a.Position[1]+d],a.Position[1]>=a.Size[1]&&(h=!1),0<a.Position[1]&&(b.Alpha=1,b.Position=[a.Position[0],a.Position[1]-b.Size[1]])):(b.Position=[b.Position[0],b.Position[1]+d],b.Position[1]>=b.Size[1]&&(h=!0),0<b.Position[1]&&(a.Position=[a.Position[0],b.Position[1]-
a.Size[1]]))}},main={start:function(d){function c(){b.run();return!1}var a=new scene(d),b=new car(d),g=new road(d);b.init(600,400,g,a);g.init(594,0);d.Start();setTimeout(function(){document.addEventListener&&document.addEventListener("DOMMouseScroll",c,!1);window.onmousewheel=document.onmousewheel=c},1E3)}};main.start(new Game({id:"maingame"}));